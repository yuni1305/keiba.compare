<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>競馬 ハイブリッド戦略シミュレーター</title>
    <style>
        :root { --primary: #2c3e50; --accent: #27ae60; --plan-a: #2980b9; --plan-b: #8e44ad; --hybrid: #e67e22; --bg: #f4f7f6; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 12px; }
        h3 { margin: 0 0 12px 0; font-size: 15px; border-left: 4px solid var(--primary); padding-left: 10px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 11px; font-weight: bold; color: #666; margin-bottom: 4px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 100px; font-family: monospace; }
        
        .plan-header-a { color: var(--plan-a); font-weight: bold; }
        .plan-header-b { color: var(--plan-b); font-weight: bold; }
        
        button { width: 100%; background: var(--primary); color: white; padding: 16px; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; margin: 10px 0; }
        .btn-hybrid { background: var(--hybrid); }

        .compare-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .compare-table th { background: #f8f9fa; padding: 8px; border: 1px solid #eee; }
        .compare-table td { padding: 8px; border: 1px solid #eee; text-align: center; }
        .win-norm { font-size: 10px; color: #e74c3c; display: block; }

        .hybrid-res { background: #fffdf0; border: 2px solid var(--hybrid); padding: 12px; border-radius: 8px; margin-top: 10px; }
        .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; color: white; font-size: 10px; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>1. 予算とハイブリッド比率</h3>
        <div class="grid">
            <div><label>総予算</label><input type="number" id="totalBudget" value="5000" step="100"></div>
            <div>
                <label>ハイブリッド配分 (A：B)</label>
                <select id="ratio" style="width:100%; padding:10px; border-radius:4px;">
                    <option value="0.8">A(8割) : B(2割) - 安定重視</option>
                    <option value="0.5" selected>A(5割) : B(5割) - バランス</option>
                    <option value="0.2">A(2割) : B(8割) - 一発逆転</option>
                </select>
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <div class="plan-header-a">プランA (守り/3連複など)</div>
            <textarea id="inputA" placeholder="1-2-3 15.0&#10;1-2-4 20.0"></textarea>
        </div>
        <div class="card">
            <div class="plan-header-b">プランB (攻め/3連単など)</div>
            <textarea id="inputB" placeholder="1-2-3 80.0&#10;1-2-4 150.0"></textarea>
        </div>
    </div>

    <button onclick="runAnalysis()">シミュレーション実行</button>

    <div id="resultArea" style="display:none;">
        <div class="card">
            <h3>2. 戦略比較 (損益分岐点)</h3>
            <table class="compare-table">
                <thead>
                    <tr><th>項目</th><th style="color:var(--plan-a)">プランA単体</th><th style="color:var(--plan-b)">プランB単体</th></tr>
                </thead>
                <tbody id="compareBody"></tbody>
            </table>
        </div>

        <div class="card hybrid-res" id="hybridBox">
            <div class="badge" style="background:var(--hybrid)">HYBRID 戦略</div>
            <div id="hybridSummary" style="font-size:14px; line-height:1.6;"></div>
        </div>
    </div>
</div>

<script>
function parseInput(text) {
    return text.trim().split('\n').map(line => {
        const parts = line.trim().split(/\s+/);
        if (parts.length < 2) return null;
        const odds = parseFloat(parts.pop());
        return { label: parts.join('-'), odds: odds };
    }).filter(v => v && !isNaN(v.odds));
}

function calc(budget, dataList) {
    if (dataList.length === 0) return null;
    const invSum = dataList.reduce((sum, d) => sum + (1/d.odds), 0);
    const synOdds = 1 / invSum;
    let currentTotal = 0;
    let al = dataList.map(d => {
        let a = Math.max(100, Math.floor((budget * (1/d.odds) / invSum) / 100) * 100);
        currentTotal += a;
        return { ...d, a: a };
    });
    while (currentTotal + 100 <= budget) {
        let target = al.reduce((min, curr) => (curr.a * curr.odds < min.a * min.odds) ? curr : min);
        target.a += 100;
        currentTotal += 100;
    }
    const payouts = al.map(a => a.a * a.odds);
    return { total: currentTotal, syn: synOdds, min: Math.min(...payouts), max: Math.max(...payouts), items: al };
}

function runAnalysis() {
    const budget = parseInt(document.getElementById('totalBudget').value);
    const ratioA = parseFloat(document.getElementById('ratio').value);
    const dataA = parseInput(document.getElementById('inputA').value);
    const dataB = parseInput(document.getElementById('inputB').value);

    if (dataA.length === 0 || dataB.length === 0) return alert("データを入力してください");

    const resA = calc(budget, dataA);
    const resB = calc(budget, dataB);
    const hyA = calc(budget * ratioA, dataA);
    const hyB = calc(budget * (1 - ratioA), dataB);

    document.getElementById('resultArea').style.display = 'block';

    // 比較表
    const createRow = (label, a, b) => `<tr><td>${label}</td><td>${a}</td><td>${b}</td></tr>`;
    document.getElementById('compareBody').innerHTML = 
        createRow("合成オッズ", resA.syn.toFixed(2)+"倍", resB.syn.toFixed(2)+"倍") +
        createRow("勝率ノルマ", `<span class="win-norm">${(100/resA.syn).toFixed(1)}%以上でプラス</span>`, `<span class="win-norm">${(100/resB.syn).toFixed(1)}%以上でプラス</span>`) +
        createRow("最低払戻", Math.floor(resA.min)+"円", Math.floor(resB.min)+"円") +
        createRow("最大払戻", Math.floor(resA.max)+"円", Math.floor(resB.max)+"円");

    // ハイブリッド詳細
    const hybridMin = (hyA ? hyA.min : 0) + (hyB ? hyB.min : 0);
    const totalSpent = (hyA ? hyA.total : 0) + (hyB ? hyB.total : 0);
    
    document.getElementById('hybridSummary').innerHTML = `
        <b>ミックス配分:</b> Aに${hyA.total}円 / Bに${hyB.total}円<br>
        <b>的中時の挙動:</b><br>
        ・プランAのみ的中：<b style="color:var(--plan-a)">${Math.floor(hyA.min)}〜${Math.floor(hyA.max)}円</b> 
        <small>(${Math.floor(hyA.min) >= totalSpent ? '利益確定！' : '軽微なマイナス'})</small><br>
        ・プランBのみ的中：<b style="color:var(--plan-b)">${Math.floor(hyB.min)}〜${Math.floor(hyB.max)}円</b><br>
        ・<span style="background:yellow">両方的中（大勝利）：</span> <b>${Math.floor(hyA.min + hyB.min)}〜${Math.floor(hyA.max + hyB.max)}円</b><br>
        <p style="font-size:11px; color:#666; margin-top:10px;">※Aで投資額の大部分を回収しつつ、Bでプラスアルファを狙う構成です。</p>
    `;
}
</script>
</body>
</html>
