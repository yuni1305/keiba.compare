<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>競馬 比較シミュレーター</title>
    <style>
        :root { --primary: #1b4332; --plan-a: #2980b9; --plan-b: #8e44ad; --bg: #f4f7f6; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #2c3e50; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 18px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        h3 { margin-top: 0; color: var(--primary); font-size: 16px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; font-weight: bold; color: #7f8c8d; margin-bottom: 4px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        textarea { height: 120px; font-family: monospace; font-size: 13px; margin-top: 5px; }
        
        .header-flex { display: flex; justify-content: space-between; align-items: flex-end; }
        .btn-paste { background: #edf2f7; color: #4a5568; border: 1px solid #cbd5e0; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; cursor: pointer; }
        
        button.btn-run { width: 100%; background: var(--primary); color: white; padding: 16px; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .summary-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: white; border-radius: 8px; overflow: hidden; font-size: 13px; }
        .summary-table th, .summary-table td { padding: 10px 8px; text-align: center; border-bottom: 1px solid #eee; }
        .summary-table th { background: #f8f9fa; font-size: 11px; color: #666; }
        
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .detail-card { background: white; padding: 12px; border-radius: 8px; border-top: 4px solid #ccc; }
        .detail-a { border-top-color: var(--plan-a); }
        .detail-b { border-top-color: var(--plan-b); }
        
        .plan-title { font-weight: bold; font-size: 13px; margin-bottom: 8px; display: block; }
        .item-row { display: flex; justify-content: space-between; font-size: 11px; padding: 4px 0; border-bottom: 1px dotted #eee; }
        .pay-val { font-weight: bold; color: #c0392b; }
        
        .res-section { display: none; }
        .safe { color: var(--primary); font-weight: bold; }
        .danger { color: #e53e3e; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>買い目比較<h3>
        <div class="input-group">
            <label>予算 (円)</label>
            <input type="number" id="budget" value="1000" step="100">
        </div>
        <div class="grid">
            <div>
                <div class="header-flex">
                    <label style="color:var(--plan-a)">プランA</label>
                    <button class="btn-paste" onclick="pasteTo('inputA')">貼り付け</button>
                </div>
                <textarea id="inputA" placeholder="1-2 5.5&#10;1-3 8.0"></textarea>
            </div>
            <div>
                <div class="header-flex">
                    <label style="color:var(--plan-b)">プランB</label>
                    <button class="btn-paste" onclick="pasteTo('inputB')">貼り付け</button>
                </div>
                <textarea id="inputB" placeholder="1-2-3 45.0&#10;1-2-4 60.0"></textarea>
            </div>
        </div>
        <button class="btn-run" onclick="runAnalysis()">シミュレーション実行
        </button>

            <a href="https://yuni1305.github.io/keiba.calc/" class="btn-secondary">
             資金配分の検討へ
        </a>

        <style>
            .btn-secondary {
                display: flex;
                align-items: center;
                justify-content: center;
                margin-top: 12px;
                padding: 12px;
                background: transparent;
                color: var(--primary);
                border: 2px solid var(--primary);
                border-radius: 4px;
                text-decoration: none;
                font-size: 14px;
                font-weight: bold;
                transition: background 0.2s;
            }
            .btn-secondary:hover {
                background: rgba(27, 67, 50, 0.05);
            }
            .btn-secondary span {
                margin-right: 8px;
            }
        </style>
    </div>

    <div id="resultArea" class="res-section">
        <div class="card" style="padding:0;">
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>比較項目</th>
                        <th style="color:var(--plan-a)">プランA</th>
                        <th style="color:var(--plan-b)">プランB</th>
                    </tr>
                </thead>
                <tbody id="summaryBody"></tbody>
            </table>
        </div>

        <div class="detail-grid">
            <div class="detail-card detail-a">
                <span class="plan-title" style="color:var(--plan-a)">プランA 配分</span>
                <div id="listA"></div>
            </div>
            <div class="detail-card detail-b">
                <span class="plan-title" style="color:var(--plan-b)">プランB 配分</span>
                <div id="listB"></div>
            </div>
        </div>
    </div>
</div>

<script>
async function pasteTo(targetId) {
    try {
        const text = await navigator.clipboard.readText();
        document.getElementById(targetId).value = text;
    } catch (err) {
        alert("貼り付けに失敗しました。枠内を長押しして貼り付けてください。");
    }
}

function parse(text) {
    return text.trim().split('\n').map(l => {
        const p = l.trim().split(/\s+/);
        const o = parseFloat(p.pop());
        return (p.length > 0 && !isNaN(o)) ? { label: p.join('-'), odds: o } : null;
    }).filter(v => v);
}

function calc(budget, data) {
    if (!data.length) return null;
    const invSum = data.reduce((s, d) => s + (1/d.odds), 0);
    let total = 0;
    let al = data.map(d => {
        let a = Math.max(100, Math.floor((budget * (1/d.odds) / invSum) / 100) * 100);
        total += a;
        return { ...d, a: a };
    });
    while (total + 100 <= budget) {
        let t = al.reduce((m, c) => (c.a * c.odds < m.a * m.odds) ? c : m);
        t.a += 100; total += 100;
    }
    const pays = al.map(a => a.a * a.odds);
    return { 
        total, 
        syn: 1/invSum, 
        minPay: Math.min(...pays), 
        maxPay: Math.max(...pays),
        minRoi: (Math.min(...pays) / total * 100).toFixed(1),
        maxRoi: (Math.max(...pays) / total * 100).toFixed(1),
        items: al
    };
}

function runAnalysis() {
    const budget = parseInt(document.getElementById('budget').value);
    const dA = parse(document.getElementById('inputA').value);
    const dB = parse(document.getElementById('inputB').value);

    if (!dA.length || !dB.length) return alert("データを入力してください");

    const resA = calc(budget, dA);
    const resB = calc(budget, dB);

    document.getElementById('resultArea').style.display = 'block';

    const getRoiClass = (roi) => roi >= 100 ? 'safe' : 'danger';

    const row = (name, valA, valB, classA='', classB='') => 
        `<tr><td>${name}</td><td class="${classA}">${valA}</td><td class="${classB}">${valB}</td></tr>`;

    document.getElementById('summaryBody').innerHTML = 
        row("合成オッズ", resA.syn.toFixed(2)+"倍", resB.syn.toFixed(2)+"倍") +
        row("最低払戻額", Math.floor(resA.minPay).toLocaleString()+"円", Math.floor(resB.minPay).toLocaleString()+"円") +
        row("最高払戻額", Math.floor(resA.maxPay).toLocaleString()+"円", Math.floor(resB.maxPay).toLocaleString()+"円") +
        row("最低回収率", resA.minRoi+"%", resB.minRoi+"%", getRoiClass(resA.minRoi), getRoiClass(resB.minRoi)) +
        row("最高回収率", resA.maxRoi+"%", resB.maxRoi+"%", getRoiClass(resA.maxRoi), getRoiClass(resB.maxRoi));

    const renderList = (res, targetId) => {
        document.getElementById(targetId).innerHTML = res.items.map(i => `
            <div class="item-row">
                <span>${i.label}</span>
                <span>${i.a}円 <small class="pay-val">➔${Math.floor(i.a * i.odds).toLocaleString()}</small></span>
            </div>
        `).join('') + `<div style="text-align:right; font-size:10px; margin-top:8px; color:#999;">予算合計: ${res.total.toLocaleString()}円</div>`;
    };

    renderList(resA, 'listA');
    renderList(resB, 'listB');
}
</script>
</body>
</html>
